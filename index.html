<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raspa Brasil - A Raspadinha Virtual Dos Brasileiros</title>

    <!-- Open Graph (Facebook, Instagram, WhatsApp) -->
    <meta property="og:title" content="Raspa Brasil - A Raspadinha Virtual dos Brasileiros">
    <meta property="og:description" content="Com apenas R$1 você pode ganhar até R$1.000. São R$30.000 em prêmios distribuídos em raspadinhas digitais de R$10 a R$1.000. Rápido, 100% online e com pagamento seguro via Pix.">
    <meta property="og:image" content="https://raspabrasil.onrender.com/static/images/logo.jpg">
    <meta property="og:url" content="https://raspabrasil.onrender.com">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="pt_BR">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-green: #00b341;
            --primary-yellow: #ffd700;
            --primary-blue: #003087;
            --primary-red: #dc2626;
            --success-green: #28a745;
            --affiliate-orange: #ff6b35;
            --gradient-bg: linear-gradient(135deg, #00b341 0%, #ffd700 50%, #003087 100%);
            --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 8px 40px rgba(0, 0, 0, 0.15);
            --shadow-heavy: 0 20px 60px rgba(0, 0, 0, 0.3);
            --border-radius: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gradient-bg);
            min-height: 100vh;
            color: #1a1a1a;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Background Animation */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 179, 65, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(0, 48, 135, 0.15) 0%, transparent 50%);
            animation: backgroundMove 25s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundMove {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(2deg); }
        }

        /* Vibração intensa para alerta de ganhador */
        @keyframes shakeIntense {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-15px) rotate(-2deg); }
            20%, 40%, 60%, 80% { transform: translateX(15px) rotate(2deg); }
        }

        @keyframes pulseGlow {
            0% { 
                box-shadow: 0 0 20px rgba(40, 167, 69, 0.8);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(40, 167, 69, 1), 0 0 80px rgba(40, 167, 69, 0.6);
                transform: scale(1.05);
            }
            100% { 
                box-shadow: 0 0 20px rgba(40, 167, 69, 0.8);
                transform: scale(1);
            }
        }

        .shake-intense {
            animation: shakeIntense 0.6s ease-in-out;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-heavy);
            margin-top: 20px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Header Moderno */
        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-yellow));
            border-radius: var(--border-radius);
            margin-bottom: 40px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 179, 65, 0.8), rgba(255, 215, 0, 0.6));
            animation: wave 4s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(-30px); }
        }

        .header h1 {
            font-size: clamp(2.5em, 8vw, 4em);
            font-weight: 800;
            margin-bottom: 15px;
            text-shadow: 3px 3px 15px rgba(0, 0, 0, 0.4);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: clamp(1em, 4vw, 1.3em);
            font-weight: 500;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        .logo-brasil {
            margin: 0 auto 20px auto;
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: center;
        }

        .logo-bandeira {
            width: clamp(60px, 15vw, 90px);
            height: clamp(60px, 15vw, 90px);
            border-radius: 50%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            animation: pulse 3s infinite;
            border: 3px solid #ffd700;
            cursor: pointer;
            transition: var(--transition);
            background-image: url('https://pfst.cf2.poecdn.net/base/image/6334603f4a3905c7fd614b3b09aa286277d7dbe6636795bc8742d06a7e88e5b8?w=980&h=980');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .logo-bandeira:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.08) rotate(5deg); }
        }

        /* Banner Slider Melhorado */
        .banner-slider {
            position: relative;
            height: clamp(300px, 50vw, 450px);
            margin-bottom: 40px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-heavy);
            background-image: url('https://pfst.cf2.poecdn.net/base/image/f5e5ea7363d8a169389771ca089524300491c180be4956341b918e8d3d1c474c?w=626&h=417');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .banner-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 179, 65, 0.3), rgba(255, 215, 0, 0.2));
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 179, 65, 0.8), rgba(255, 215, 0, 0.6));
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slide.active {
            opacity: 1;
        }

        .slide-content {
            background: linear-gradient(135deg, rgba(0, 179, 65, 0.95), rgba(255, 215, 0, 0.9));
            color: white;
            padding: clamp(20px, 6vw, 40px);
            border-radius: 20px;
            text-align: center;
            backdrop-filter: blur(15px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            border: 3px solid rgba(255, 255, 255, 0.3);
            max-width: 90%;
            animation: slideContentFloat 6s ease-in-out infinite;
        }

        @keyframes slideContentFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .slide-content h1 {
            font-size: clamp(2em, 7vw, 4em);
            font-weight: 800;
            margin-bottom: 15px;
            text-shadow: 3px 3px 15px rgba(0, 0, 0, 0.5);
        }

        .slide-content p {
            font-size: clamp(1em, 4vw, 1.4em);
            font-weight: 600;
            opacity: 0.95;
        }

        /* Botões Modernos */
        .btn {
            padding: clamp(14px, 4vw, 18px) clamp(28px, 6vw, 36px);
            border: none;
            border-radius: 15px;
            font-size: clamp(14px, 4vw, 17px);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: var(--transition);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-green), #00a538);
            color: white;
            box-shadow: var(--shadow-medium);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: var(--shadow-heavy);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--primary-yellow), #ffcc00);
            color: #333;
            box-shadow: var(--shadow-medium);
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: var(--shadow-heavy);
        }

        .btn-affiliate {
            background: linear-gradient(135deg, var(--affiliate-orange), #f7931e);
            color: white;
            box-shadow: var(--shadow-medium);
        }

        .btn-affiliate:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: var(--shadow-heavy);
        }

        .btn-cta {
            background: linear-gradient(135deg, var(--success-green), #1e7e34);
            color: white;
            font-size: clamp(18px, 5vw, 22px);
            padding: clamp(18px, 5vw, 22px) clamp(36px, 8vw, 45px);
            animation: ctaPulse 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(40, 167, 69, 0.6);
        }

        @keyframes ctaPulse {
            0% { 
                transform: scale(1);
                box-shadow: 0 0 30px rgba(40, 167, 69, 0.6);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 50px rgba(40, 167, 69, 0.9);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 0 30px rgba(40, 167, 69, 0.6);
            }
        }

        .btn-cta:hover {
            animation-play-state: paused;
            transform: scale(1.08);
            box-shadow: 0 0 60px rgba(40, 167, 69, 1);
        }

        /* Seção Principal Melhorada - RESPONSIVIDADE MOBILE CORRIGIDA */
        .main-section {
            text-align: center;
            margin-bottom: 50px;
            padding: 0 15px;
        }

        .main-section h2 {
            font-size: clamp(2em, 6vw, 3em);
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .main-section .subtitle {
            font-size: clamp(1.1em, 4vw, 1.4em);
            color: #555;
            margin-bottom: 30px;
            font-weight: 600;
        }

        /* Informações de segurança lado a lado - MOBILE RESPONSIVO */
        .security-info {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            align-items: center;
            justify-content: center;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .security-item {
            font-size: clamp(0.9em, 3.5vw, 1.1em);
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(40, 167, 69, 0.2);
            text-align: center;
        }

        .security-item i {
            color: var(--success-green);
            font-size: 1.2em;
        }

        /* CTA Messages */
        .cta-message {
            background: linear-gradient(135deg, var(--primary-red), #ef4444);
            color: white;
            padding: clamp(20px, 5vw, 30px);
            border-radius: var(--border-radius);
            margin: 30px 0;
            text-align: center;
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
        }

        .cta-message.success {
            background: linear-gradient(135deg, var(--success-green), #1e7e34);
        }

        .cta-message.warning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .cta-message.affiliate {
            background: linear-gradient(135deg, var(--primary-yellow), #ffcc00);
            color: #1a1a1a;
        }

        .cta-message::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .cta-message h3 {
            font-size: clamp(1.3em, 5vw, 1.8em);
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .cta-message p {
            position: relative;
            z-index: 1;
        }

        .urgency-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.25);
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 700;
            margin-top: 15px;
            position: relative;
            z-index: 1;
        }

        /* Promoção 10+2 */
        .promocao-bonus {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: clamp(15px, 4vw, 20px);
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            box-shadow: var(--shadow-medium);
            font-weight: 700;
            display: none;
        }

        .promocao-bonus.ativa {
            display: block;
            animation: pulseGlow 1.5s ease-in-out infinite;
        }

        /* Quantidade Selector Melhorado - MOBILE OTIMIZADO */
        .quantidade-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(20px, 6vw, 30px);
            margin: 40px auto;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 249, 250, 0.95));
            padding: clamp(25px, 6vw, 35px);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            backdrop-filter: blur(10px);
            max-width: 90%;
        }

        .quantidade-btn {
            width: clamp(50px, 14vw, 70px);
            height: clamp(50px, 14vw, 70px);
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-green), #00a538);
            color: white;
            font-size: clamp(24px, 6vw, 32px);
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-light);
        }

        .quantidade-btn:hover {
            transform: scale(1.15);
            box-shadow: var(--shadow-heavy);
        }

        .quantidade-display {
            font-size: clamp(3em, 10vw, 5em);
            font-weight: 900;
            color: var(--primary-green);
            min-width: clamp(80px, 20vw, 120px);
            text-align: center;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .total-display {
            text-align: center;
            font-size: clamp(1.8em, 7vw, 2.8em);
            font-weight: 800;
            color: var(--primary-blue);
            margin: 30px auto;
            padding: clamp(20px, 5vw, 30px);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 249, 250, 0.95));
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            backdrop-filter: blur(10px);
            max-width: 90%;
        }

        /* Winners Slider - Ganhadores das últimas horas */
        .winners-slider {
            background: linear-gradient(135deg, #f0f9f0, #e8f5e8);
            padding: clamp(25px, 6vw, 40px);
            border-radius: var(--border-radius);
            margin: 40px 0;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-medium);
            border: 3px solid #28a745;
        }

        .winners-container {
            display: flex;
            gap: 20px;
            animation: scrollLeft 45s linear infinite;
            width: max-content;
        }

        .winners-container:hover {
            animation-play-state: paused;
        }

        @keyframes scrollLeft {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%);
            }
        }

        .winner-item {
            min-width: 280px;
            background: white;
            padding: clamp(20px, 5vw, 25px);
            border-radius: 15px;
            box-shadow: var(--shadow-light);
            text-align: center;
            flex-shrink: 0;
            border: 2px solid #28a745;
            position: relative;
        }

        .winner-item::before {
            content: '';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 30px;
            background: #28a745;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .winner-name {
            font-size: clamp(1.1em, 3.5vw, 1.3em);
            font-weight: 800;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .winner-prize {
            font-size: clamp(1.3em, 4vw, 1.6em);
            font-weight: 900;
            color: #28a745;
            margin-bottom: 8px;
        }

        .winner-time {
            font-size: clamp(0.85em, 3vw, 1em);
            color: #666;
            font-weight: 600;
        }

        /* Affiliate Styles */
        .affiliate-section {
            background: linear-gradient(135deg, var(--primary-yellow), #ffcc00);
            padding: clamp(30px, 6vw, 50px);
            border-radius: var(--border-radius);
            margin: 40px 0;
            box-shadow: var(--shadow-medium);
            color: #1a1a1a;
        }

        .affiliate-link-display {
            background: white;
            border: 3px solid var(--affiliate-orange);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            word-break: break-all;
            font-family: monospace;
            font-size: clamp(12px, 3vw, 14px);
            color: var(--affiliate-orange);
            font-weight: 700;
        }

        .affiliate-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .affiliate-stat-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid var(--affiliate-orange);
            box-shadow: var(--shadow-light);
        }

        .affiliate-stat-number {
            font-size: clamp(1.8em, 5vw, 2.5em);
            font-weight: 900;
            color: var(--affiliate-orange);
            display: block;
        }

        .affiliate-stat-label {
            font-size: clamp(0.9em, 3vw, 1.1em);
            color: #666;
            font-weight: 600;
        }

        /* BUTTONS MOBILE FIX - MELHORADO */
        .affiliate-buttons-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 25px;
        }

        .affiliate-buttons-container .btn {
            width: 100%;
            margin: 0;
            text-align: center;
        }

        /* Status Bar - Only for Admin */
        .status-bar {
            background: linear-gradient(90deg, var(--primary-green), var(--primary-yellow));
            padding: clamp(15px, 4vw, 20px);
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            color: white;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .status-item {
            text-align: center;
            padding: 10px;
        }

        .status-item .number {
            font-size: clamp(1.5em, 5vw, 2em);
            font-weight: 800;
            display: block;
        }

        .status-item .label {
            font-size: clamp(0.8em, 3vw, 1em);
            opacity: 0.9;
        }

        /* Modal Admin */
        .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }

        .admin-modal-content {
            background: white;
            padding: clamp(25px, 6vw, 40px);
            border-radius: var(--border-radius);
            max-width: 900px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
        }

        /* Payment Page Melhorada */
        .payment-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: clamp(25px, 6vw, 40px);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
        }

        .qr-container {
            background: linear-gradient(135deg, #f8f9fa, white);
            padding: clamp(25px, 6vw, 40px);
            border-radius: var(--border-radius);
            text-align: center;
            margin: 30px 0;
            box-shadow: var(--shadow-light);
        }

        .qr-code img {
            max-width: min(200px, 70vw);
            max-height: min(200px, 70vw);
            width: auto;
            height: auto;
            border: 3px solid var(--primary-green);
            border-radius: 12px;
            box-shadow: var(--shadow-medium);
        }

        .pix-code {
            background: #f8f9fa;
            padding: clamp(15px, 4vw, 20px);
            border-radius: 12px;
            margin: 25px 0;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: clamp(11px, 3vw, 14px);
            border: 2px dashed var(--primary-green);
            color: #1a1a1a;
            font-weight: 600;
            line-height: 1.4;
            max-height: 120px;
            overflow-y: auto;
        }

        /* Raspadinha Page com NOVO MODELO */
        .raspadinha-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            background: #0d1b0d;
            color: white;
            border-radius: var(--border-radius);
            margin: 40px 0;
            padding: 40px;
        }

        .raspadinha-content {
            text-align: center;
            width: 100%;
        }

        .raspadinha-titulo {
            margin-bottom: 30px;
            font-size: clamp(1.2em, 4vw, 1.8em);
            font-weight: 700;
        }

        .raspadinha {
            position: relative;
            width: 300px;
            height: 180px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            margin: 0 auto;
            max-width: 90vw;
        }

        .premio {
            position: absolute;
            inset: 0;
            background: #004aad;
            color: #fff;
            font-size: 26px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            flex-direction: column;
        }

        .raspadinha canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: pointer;
        }

        /* Grid de Raspadinhas */
        .raspadinha-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(300px, 80vw), 1fr));
            gap: clamp(20px, 5vw, 40px);
            margin: 50px 0;
            padding: clamp(20px, 5vw, 30px);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.6), rgba(248, 249, 250, 0.6));
            border-radius: var(--border-radius);
            backdrop-filter: blur(15px);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: #333;
            font-size: clamp(14px, 3.5vw, 16px);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: clamp(14px, 4vw, 18px);
            border: 3px solid #ddd;
            border-radius: 12px;
            font-size: clamp(16px, 4vw, 18px);
            transition: var(--transition);
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary-green);
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 179, 65, 0.15);
        }

        /* Loading Animation */
        .loading {
            text-align: center;
            padding: 50px;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Winner Alert Modal - COR VERDE */
        .winner-alert {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .winner-alert-content {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: clamp(30px, 8vw, 50px);
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 25px 80px rgba(40, 167, 69, 0.9);
            border: 4px solid #ffd700;
            max-width: 90%;
            position: relative;
            overflow: hidden;
            animation: pulseGlow 1s ease-in-out infinite;
        }

        .winner-alert-content::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 60px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            40% {
                transform: translateX(-50%) translateY(-10px);
            }
            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        .winner-alert h2 {
            font-size: clamp(1.8em, 6vw, 2.5em);
            margin: 30px 0 20px 0;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .winner-alert p {
            font-size: clamp(1.1em, 4vw, 1.4em);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .winner-alert .close-btn {
            background: #ffd700;
            color: #1a1a1a;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: clamp(1em, 4vw, 1.2em);
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: var(--transition);
            text-transform: uppercase;
            animation: pulseGlow 0.8s infinite;
        }

        .winner-alert .close-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5);
        }

        /* Admin Tabs */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 12px 20px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .admin-tab.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        /* Resultado Validação */
        .resultado-validacao {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: 700;
        }

        .resultado-validacao.valido {
            background: #d4edda;
            color: #155724;
            border: 3px solid #c3e6cb;
        }

        .resultado-validacao.invalido {
            background: #f8d7da;
            color: #721c24;
            border: 3px solid #f5c6cb;
        }

        .premiados-table {
            margin-top: 25px;
            max-height: 450px;
            overflow-y: auto;
        }

        .premiado-item {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 15px;
            border-left: 6px solid #28a745;
            box-shadow: var(--shadow-light);
        }

        /* Configuração de Prêmios */
        .premio-config {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid #dee2e6;
        }

        .premio-config h4 {
            color: var(--primary-green);
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .premio-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .premio-form-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .premio-form-item label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .premio-form-item input,
        .premio-form-item select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        /* WhatsApp Button */
        .whatsapp-btn {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            padding: clamp(16px, 4vw, 20px) clamp(32px, 6vw, 40px);
            border: none;
            border-radius: 15px;
            font-size: clamp(16px, 4vw, 20px);
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-top: 25px;
            transition: var(--transition);
            box-shadow: var(--shadow-medium);
        }

        .whatsapp-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-heavy);
        }

        /* Premio Form */
        .premio-form {
            background: linear-gradient(135deg, #e8f5e8, #f0f9f0);
            padding: clamp(25px, 6vw, 40px);
            border-radius: var(--border-radius);
            margin: 40px 0;
            border: 4px solid #4CAF50;
            box-shadow: var(--shadow-medium);
        }

        .premio-form h3 {
            color: #4CAF50;
            font-size: clamp(1.5em, 5vw, 2.2em);
            margin-bottom: 25px;
            text-align: center;
            font-weight: 800;
        }

        /* Payment Status Messages */
        .payment-status-waiting {
            background: linear-gradient(135deg, #ffc107, #ff9800);
            color: #1a1a1a;
            font-weight: 700;
        }

        .payment-status-approved {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .payment-status-error {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        @keyframes pulse-glow {
            0% {
                box-shadow: 0 8px 25px rgba(252, 199, 85, 0.507);
            }
            50% {
                box-shadow: 0 12px 35px rgba(245, 255, 107, 0.664), 0 0 0 10px rgba(255, 107, 107, 0.1);
                transform: scale(1.05);
            }
            100% {
                box-shadow: 0 8px 25px rgba(255, 240, 107, 0.4);
            }
        }

        /* RESPONSIVE MELHORADO PARA MOBILE */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .winners-slider {
                padding: 20px 15px;
            }

            .quantidade-selector {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 20px;
                padding: 25px 15px;
            }

            .status-bar {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 10px;
            }

            .status-item {
                padding: 8px;
            }

            .security-info {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-top: 15px;
            }

            .security-item {
                padding: 12px 15px;
                font-size: 0.9em;
            }

            .qr-code img {
                max-width: min(180px, 75vw);
                max-height: min(180px, 75vw);
            }

            .pix-code {
                font-size: clamp(10px, 2.8vw, 12px);
                padding: clamp(12px, 3vw, 15px);
                line-height: 1.3;
            }
            
            .affiliate-stats {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 15px;
            }

            .raspadinha {
                width: min(280px, 90vw);
                height: min(168px, 54vw);
            }

            .affiliate-buttons-container {
                gap: 15px;
            }
            
            .affiliate-buttons-container .btn {
                padding: 16px 20px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .banner-slider {
                height: clamp(250px, 60vw, 350px);
            }

            .slide-content {
                padding: 20px 15px;
                max-width: 95%;
            }

            .qr-code img {
                max-width: min(150px, 80vw);
                max-height: min(150px, 80vw);
            }

            .pix-code {
                font-size: 10px;
                padding: 10px;
                line-height: 1.2;
            }

            .raspadinha {
                width: min(260px, 90vw);
                height: min(156px, 54vw);
            }

            .quantidade-selector {
                gap: 15px;
                padding: 20px 10px;
            }

            .total-display {
                font-size: clamp(1.5em, 6vw, 2.2em);
                padding: 15px;
            }
        }

        /* Utility Classes */
        .page {
            display: none;
            animation: fadeIn 0.6s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: white;
            padding: clamp(25px, 6vw, 40px);
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: var(--shadow-heavy);
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            .dark {
                color-scheme: dark;
            }
            
            .dark .container {
                background: rgba(30, 30, 30, 0.98);
                color: #f1f1f1;
            }
            
            .dark .form-group input,
            .dark .form-group select {
                background: #2a2a2a;
                color: #f1f1f1;
                border-color: #555;
            }
            
            .dark .form-group input:focus,
            .dark .form-group select:focus {
                border-color: var(--primary-green);
                background: #333;
            }
            
            .dark .modal-content,
            .dark .admin-modal-content {
                background: #2a2a2a;
                color: #f1f1f1;
            }
            
            .dark .winner-item {
                background: #2a2a2a;
                color: #f1f1f1;
            }
            
            .dark .pix-code {
                background: #2a2a2a;
                color: #f1f1f1;
                border-color: var(--primary-green);
            }
            
            .dark .premiado-item {
                background: #2a2a2a;
                color: #f1f1f1;
            }
        }
    </style>
</head>
<body>
    <!-- Botão Indique e Ganhe simples no topo -->
    <div style="text-align: center; margin-bottom: 20px; padding: 10px;">
    <button onclick="abrirAfiliados()" 
            style="
                background: linear-gradient(135deg, #77ff6b59, #ffd93d);
                border: none;
                border-radius: 50px;
                padding: 18px 35px;
                color: #fff;
                font-size: clamp(16px, 4vw, 20px);
                font-weight: 800;
                text-transform: uppercase;
                letter-spacing: 1.5px;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
                overflow: hidden;
                position: relative;
                animation: pulse-glow 2s infinite;
            "
            onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 35px rgba(255, 107, 107, 0.6)'; this.style.animationPlayState='paused';"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(255, 107, 107, 0.4)'; this.style.animationPlayState='running';">
        INDIQUE E GANHE
    </button>
</div>

    <div class="container">
        <!-- Página Inicial -->
        <div id="home-page" class="page active">
            <!-- Banner de Cidades Brasileiras com Header Integrado -->
            <div class="banner-slider">
                <div class="banner-image"></div>
                <div class="slide active">
                    <div class="slide-content">
                        <div class="logo-brasil">
                            <div class="logo-bandeira" onclick="abrirAdmin()" title="">
                            </div>
                        </div>
                        <h1>RASPA BRASIL</h1>
                        <p>A Melhor Raspadinha Virtual do Brasil!</p>
                    </div>
                </div>
                <div class="slide">
                    <div class="slide-content">
                        <div class="logo-brasil">
                            <div class="logo-bandeira" onclick="abrirAdmin()" title="">
                            </div>
                        </div>
                        <h1>RASPA BRASIL</h1>
                        <p>Prêmios de R$ 1,00 até R$ 1000!</p>
                    </div>
                </div>
                <div class="slide">
                    <div class="slide-content">
                        <div class="logo-brasil">
                            <div class="logo-bandeira" onclick="abrirAdmin()" title="">
                            </div>
                        </div>
                        <h1>RASPA BRASIL</h1>
                        <p>Sistema 100% Seguro!</p>
                    </div>
                </div>
                <div class="slide">
                    <div class="slide-content">
                        <div class="logo-brasil">
                            <div class="logo-bandeira" onclick="abrirAdmin()" title="">
                            </div>
                        </div>
                        <h1>RASPA BRASIL</h1>
                        <p>Pagamento feito na hora!</p>
                    </div>
                </div>
                <div class="slide">
                    <div class="slide-content">
                        <div class="logo-brasil">
                            <div class="logo-bandeira" onclick="abrirAdmin()" title="">
                            </div>
                        </div>
                        <h1>RASPA BRASIL</h1>
                        <p>Raspou, Achou, Ganhou!</p>
                    </div>
                </div>
            </div>

            <!-- CTA Message -->
            <div class="cta-message">
                <h3>RASPADINHAS LIMITADAS!</h3>
                <p>Poucas <strong>raspadinhas disponíveis</strong> - Ganhe de R$ 1,00 até R$ 1000!</p>
                <div class="urgency-indicator">
                    Corre que ainda dá tempo!
                </div>
            </div>

            <div class="main-section">
                <h2>Ganhe de R$ 1,00 até R$ 1000,00!</h2>
                <p class="subtitle">Cada raspadinha custa apenas <strong>R$ 1,00</strong></p>
                
                <div class="quantidade-selector">
                    <button class="quantidade-btn" onclick="diminuirQuantidade()">
                        -
                    </button>
                    <div id="quantidade-display" class="quantidade-display">1</div>
                    <button class="quantidade-btn" onclick="aumentarQuantidade()">
                        +
                    </button>
                </div>

                <!-- Promoção 10+2 -->
                <div id="promocao-bonus" class="promocao-bonus">
                    <h3>PROMOÇÃO ESPECIAL!</h3>
                    <p>Comprando 10 raspadinhas você ganha mais <strong>2 GRÁTIS!</strong></p>
                    <p>Total: <strong>12 raspadinhas</strong> por R$ 10,00</p>
                </div>
                
                <div id="total-display" class="total-display">
                    Total: R$ 1,00
                </div>
                
                <button class="btn btn-cta" onclick="irParaPagamento()">
                    COMPRAR AGORA
                </button>

                <div class="security-info">
                    <div class="security-item">
                        <span>Pagamento 100% seguro</span>
                    </div>
                    <div class="security-item">
                        <span>Prêmios pagos na hora</span>
                    </div>
                    <div class="security-item">
                        <span>Sistema antifraude</span>
                    </div>
                </div>
            </div>

            <!-- Ganhadores das últimas horas -->
            <div class="winners-slider">
                <h3 style="text-align: center; margin-bottom: 30px; font-size: clamp(1.8em, 6vw, 2.5em); color: #28a745; font-weight: 800;">Ganhadores das últimas horas:</h3>
                <div class="winners-container" id="winners-container">
                    <!-- Será preenchido dinamicamente -->
                </div>
            </div>
        </div>

        <!-- Página de Afiliados -->
        <div id="affiliate-page" class="page">
            <div class="header">
                <div class="logo-brasil">
                    <div class="logo-bandeira" onclick="abrirAdmin()" title="">
                    </div>
                </div>
                <h1>PROGRAMA DE AFILIADOS</h1>
                <p>Ganhe 50% de comissão em cada venda!</p>
            </div>

            <!-- Formulário de Cadastro ou Área do Afiliado -->
            <div id="affiliate-signup">
                <div class="cta-message affiliate">
                    <h3>SEJA UM AFILIADO RASPA BRASIL!</h3>
                    <p>Ganhe <strong>50% de comissão</strong> em cada venda que você indicar!</p>
                    <div class="urgency-indicator">
                        <span>R$ 0,50 por raspadinha vendida!</span>
                    </div>
                </div>

                <div style="background: white; padding: clamp(25px, 6vw, 40px); border-radius: var(--border-radius); box-shadow: var(--shadow-medium);">
                    <h3 style="text-align: center; margin-bottom: 30px; color: var(--affiliate-orange);">
                        Cadastre-se como Afiliado
                    </h3>
                    
                    <div class="form-group">
                        <label>Nome Completo:</label>
                        <input type="text" id="affiliate-nome" placeholder="Digite seu nome completo">
                    </div>
                    
                    <div class="form-group">
                        <label>Telefone/WhatsApp:</label>
                        <input type="tel" id="affiliate-telefone" placeholder="(11) 99999-9999">
                    </div>
                    
                    <div class="form-group">
                        <label>E-mail:</label>
                        <input type="email" id="affiliate-email" placeholder="seu@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label>CPF:</label>
                        <input type="text" id="affiliate-cpf" placeholder="000.000.000-00" maxlength="14" oninput="mascaraCPF(this)">
                    </div>
                    
                    <div class="affiliate-buttons-container">
                        <button class="btn btn-affiliate" onclick="cadastrarAfiliado()">
                            CRIAR MINHA CONTA DE AFILIADO
                        </button>
                        
                        <button class="btn btn-secondary" onclick="mostrarLoginAfiliado()">
                            JÁ SOU AFILIADO
                        </button>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #e8f4f8, #d1ecf1); padding: 25px; border-radius: 15px; margin-top: 30px; text-align: center;">
                    <h4 style="color: var(--affiliate-orange); margin-bottom: 20px;">
                        Como funciona:
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; text-align: left;">
                        <div>
                            <strong>1. Cadastre-se</strong><br>
                            Preencha seus dados e receba seu link personalizado
                        </div>
                        <div>
                            <strong>2. Compartilhe</strong><br>
                            Envie seu link para amigos e redes sociais
                        </div>
                        <div>
                            <strong>3. Ganhe</strong><br>
                            Receba 50% de cada venda realizada pelo seu link
                        </div>
                        <div>
                            <strong>4. Saque</strong><br>
                            Solicite saque a partir de R$ 10,00 via PIX
                        </div>
                    </div>
                </div>
            </div>

            <!-- Login do Afiliado -->
            <div id="affiliate-login" style="display: none;">
                <div style="background: white; padding: clamp(25px, 6vw, 40px); border-radius: var(--border-radius); box-shadow: var(--shadow-medium);">
                    <h3 style="text-align: center; margin-bottom: 30px; color: var(--affiliate-orange);">
                        Área do Afiliado
                    </h3>
                    
                    <div class="form-group">
                        <label>CPF:</label>
                        <input type="text" id="login-affiliate-cpf" placeholder="000.000.000-00" maxlength="14" oninput="mascaraCPF(this)">
                    </div>
                    
                    <div class="affiliate-buttons-container">
                        <button class="btn btn-affiliate" onclick="loginAfiliado()">
                            ENTRAR NA MINHA ÁREA
                        </button>
                        
                        <button class="btn btn-secondary" onclick="voltarCadastroAfiliado()">
                            Voltar ao Cadastro
                        </button>
                    </div>
                    
                    <div id="login-affiliate-message" style="margin-top: 20px;"></div>
                </div>
            </div>

            <!-- Área do Afiliado (após login) -->
            <div id="affiliate-dashboard" style="display: none;">
                <div class="affiliate-section">
                    <h3 style="text-align: center; color: var(--affiliate-orange); margin-bottom: 25px;">
                        Painel do Afiliado
                    </h3>
                    
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h4>Bem-vindo(a), <span id="affiliate-name-display">Afiliado</span>!</h4>
                        <p>Seu link personalizado:</p>
                        <div class="affiliate-link-display" id="affiliate-link-display">
                            https://raspabrasil.com/?ref=SEUCODIGO
                        </div>
                        <button class="btn btn-secondary" onclick="copiarLinkAfiliado()" style="margin-top: 15px;">
                            Copiar Link
                        </button>
                    </div>
                    
                    <div class="affiliate-stats">
                        <div class="affiliate-stat-item">
                            <span class="affiliate-stat-number" id="affiliate-clicks">0</span>
                            <span class="affiliate-stat-label">Cliques</span>
                        </div>
                        <div class="affiliate-stat-item">
                            <span class="affiliate-stat-number" id="affiliate-sales">0</span>
                            <span class="affiliate-stat-label">Vendas</span>
                        </div>
                        <div class="affiliate-stat-item">
                            <span class="affiliate-stat-number" id="affiliate-commission">R$ 0,00</span>
                            <span class="affiliate-stat-label">Comissão Total</span>
                        </div>
                        <div class="affiliate-stat-item">
                            <span class="affiliate-stat-number" id="affiliate-balance">R$ 0,00</span>
                            <span class="affiliate-stat-label">Saldo</span>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 25px; border-radius: 15px; margin-top: 30px;">
                        <h4 style="color: var(--affiliate-orange); margin-bottom: 20px;">
                            Configurar PIX para Saque
                        </h4>
                        
                        <div class="form-group">
                            <label>Tipo de Chave PIX:</label>
                            <select id="affiliate-pix-type">
                                <option value="cpf">CPF</option>
                                <option value="email">E-mail</option>
                                <option value="telefone">Telefone</option>
                                <option value="aleatoria">Chave Aleatória</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Chave PIX:</label>
                            <input type="text" id="affiliate-pix-key" placeholder="Digite sua chave PIX">
                        </div>
                        
                        <div class="affiliate-buttons-container">
                            <button class="btn btn-primary" onclick="salvarChavePix()">
                                Salvar Chave PIX
                            </button>
                            
                            <button class="btn btn-affiliate" onclick="solicitarSaque()" id="btn-saque" disabled>
                                Solicitar Saque (Min. R$ 10,00)
                            </button>
                        </div>
                    </div>
                    
                    <div class="cta-message success" style="margin-top: 30px;">
                        <h4>Dicas para Aumentar suas Vendas:</h4>
                        <ul style="text-align: left; margin: 15px 0; padding-left: 20px;">
                            <li>Compartilhe nas redes sociais (Instagram, Facebook, TikTok)</li>
                            <li>Envie para grupos de WhatsApp e Telegram</li>
                            <li>Conte para amigos e família sobre os prêmios</li>
                            <li>Mostre os ganhadores para aumentar a credibilidade</li>
                        </ul>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-secondary" onclick="logoutAfiliado()">
                            Sair da Conta
                        </button>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn btn-secondary" onclick="voltarInicio()">
                    Voltar ao Início
                </button>
            </div>
        </div>

        <!-- Página de Pagamento -->
        <div id="payment-page" class="page">
            <div class="header">
                <div class="logo-brasil">
                    <div class="logo-bandeira" onclick="abrirAdmin()" title="">
                    </div>
                </div>
                <h1>RASPA BRASIL</h1>
                <p>Finalize seu pagamento</p>
            </div>

            <div class="payment-container">
                <div style="text-align: center; margin-bottom: 40px;">
                    <h2 style="color: #1a1a1a;">Pagamento via PIX</h2>
                    <p style="font-size: clamp(1.1em, 4vw, 1.3em); margin: 15px 0; font-weight: 600; color: #1a1a1a;">
                        Quantidade: <strong><span id="quantidade-pagamento">1</span> raspadinha(s)</strong>
                    </p>
                    <div style="background: linear-gradient(135deg, #00b341, #003087); color: white; padding: clamp(15px, 4vw, 25px); border-radius: 15px; font-size: clamp(1.3em, 5vw, 1.8em); font-weight: 800; box-shadow: 0 8px 25px rgba(0,0,0,0.2);">
                        Total: R$ <span id="total-pagamento">1,00</span>
                    </div>
                </div>

                <div id="payment-status">
                    <div class="loading">
                        <p style="font-size: clamp(1.1em, 4vw, 1.3em); margin-bottom: 25px; font-weight: 600; color: #1a1a1a;">Gerando seu QR Code PIX...</p>
                    </div>
                </div>

                <div class="qr-container" id="qr-section" style="display: none;">
                    <h3 style="color: #1a1a1a;">Escaneie o QR Code</h3>
                    <div id="qr-code" class="qr-code"></div>
                    
                    <div style="margin: 25px 0;">
                        <p style="font-weight: 700; margin-bottom: 15px; font-size: clamp(1em, 3.5vw, 1.2em); color: #1a1a1a;">
                            Ou copie o código PIX:
                        </p>
                        <div class="pix-code" id="pix-code"></div>
                        <button class="btn btn-secondary" onclick="copiarCodigoPix()">
                            Copiar Código PIX
                        </button>
                    </div>

                    <div id="payment-actions">
                        <button class="btn btn-primary" onclick="criarPagamentoReal()" style="width: 100%; margin-top: 25px;" id="btn-real-payment">
                            Pagar com PIX
                        </button>

                        <div class="cta-message warning" style="margin: 25px 0;">
                            <h4>Importante!</h4>
                            <p style="margin: 10px 0; font-size: clamp(0.9em, 3vw, 1.1em);">
                                • Pagamento deve ser aprovado para liberar as raspadinhas<br>
                                • Aguarde a confirmação automática após o PIX<br>
                                • Não feche esta página durante o pagamento
                            </p>
                        </div>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #fff3cd, #ffeaa7); padding: clamp(20px, 5vw, 30px); border-radius: 15px; margin: 35px 0; border: 3px solid #ffc107;">
                    <h4 style="margin-bottom: 20px; font-size: clamp(1.1em, 4vw, 1.4em); font-weight: 800; color: #1a1a1a;">
                        Como pagar:
                    </h4>
                    <ol style="line-height: 2; padding-left: 25px; font-size: clamp(0.95em, 3.5vw, 1.1em); color: #1a1a1a; font-weight: 600;">
                        <li><strong>Clique em "Pagar com PIX"</strong></li>
                        <li><strong>Abra o app do seu banco</strong></li>
                        <li><strong>Escolha a opção PIX</strong></li>
                        <li><strong>Escaneie o QR Code ou cole o código</strong></li>
                        <li><strong>Confirme o pagamento de R$ <span id="total-pagamento-info">1,00</span></strong></li>
                        <li><strong>Aguarde a confirmação automática</strong></li>
                    </ol>
                </div>

                <div style="text-align: center;">
                    <button class="btn btn-secondary" onclick="voltarInicio()">
                        Voltar ao Início
                    </button>
                </div>
            </div>
        </div>

        <!-- Página de Raspadinhas com NOVO MODELO -->
        <div id="raspadinha-page" class="page">
            <div class="header">
                <div class="logo-brasil">
                    <div class="logo-bandeira" onclick="abrirAdmin()" title="">
                    </div>
                </div>
                <h1>RASPA BRASIL</h1>
                <p>Suas raspadinhas estão prontas!</p>
            </div>

            <div style="text-align: center; margin-bottom: 50px;">
                <h2 style="font-size: clamp(2em, 7vw, 3em); color: #00b341; font-weight: 800;">
                    Deslize nas bandeiras para raspar!
                </h2>
                <p style="font-size: clamp(1.2em, 5vw, 1.5em); margin: 20px 0; font-weight: 600;">
                    Você tem <strong><span id="quantidade-raspadinhas">1</span></strong> raspadinha(s) para jogar
                </p>
                <div class="cta-message success" style="margin: 25px auto; max-width: 600px;">
                    <h3>Boa sorte!</h3>
                    <p>Raspe as bandeiras do Brasil e descubra se você ganhou!</p>
                </div>
            </div>

            <div class="raspadinha-grid" id="raspadinha-grid">
                <!-- Raspadinhas serão geradas dinamicamente -->
            </div>

            <div id="premio-container" style="display: none;"></div>

            <div style="text-align: center; margin-top: 50px;">
                <button class="btn btn-secondary" onclick="voltarInicio()">
                    Voltar ao Início
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Admin -->
    <div id="admin-modal" class="admin-modal">
        <div class="admin-modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2>Área Administrativa</h2>
                <button onclick="fecharAdmin()" style="background: none; border: none; font-size: 30px; cursor: pointer; color: #666;">×</button>
            </div>

            <div id="admin-login">
                <div class="form-group">
                    <label>Senha Administrativa:</label>
                    <input type="password" id="admin-senha" placeholder="Digite a senha">
                </div>
                <button class="btn btn-primary" onclick="loginAdmin()" style="width: 100%;">
                    Entrar
                </button>
                <div id="admin-message" style="margin-top: 20px;"></div>
            </div>

            <div id="admin-panel" style="display: none;">
                <!-- Abas do Admin -->
                <div class="admin-tabs">
                    <div class="admin-tab active" onclick="trocarAbaAdmin('dashboard')">Dashboard</div>
                    <div class="admin-tab" onclick="trocarAbaAdmin('controle-premios')">Prêmios</div>
                    <div class="admin-tab" onclick="trocarAbaAdmin('controle-afiliados')">Afiliados</div>
                    <div class="admin-tab" onclick="trocarAbaAdmin('controle-saques')">Saques</div>
                    <div class="admin-tab" onclick="trocarAbaAdmin('controle-ganhadores')">Ganhadores</div>
                    <div class="admin-tab" onclick="trocarAbaAdmin('controle-vendas')">Vendas</div>
                    <div class="admin-tab" onclick="trocarAbaAdmin('controle-pagamentos')">Pagamentos</div>
                </div>

                <!-- Dashboard -->
                <div id="admin-dashboard" class="admin-tab-content active">
                    <!-- Estatísticas -->
                    <div class="status-bar">
                        <div class="status-item">
                            <span class="number" id="admin-vendidas">0</span>
                            <span class="label">Vendidas</span>
                        </div>
                        <div class="status-item">
                            <span class="number" id="admin-restantes">10000</span>
                            <span class="label">Restantes</span>
                        </div>
                        <div class="status-item">
                            <span class="number" id="admin-porcentagem">0%</span>
                            <span class="label">Progresso</span>
                        </div>
                        <div class="status-item">
                            <span class="number" id="admin-ganhadores">0</span>
                            <span class="label">Ganhadores</span>
                        </div>
                        <div class="status-item">
                            <span class="number" id="admin-afiliados">0</span>
                            <span class="label">Afiliados</span>
                        </div>
                        <div class="status-item">
                            <span class="number" id="admin-premios-restantes">0</span>
                            <span class="label">Prêmios Restantes</span>
                        </div>
                    </div>

                    <!-- Validador de Códigos -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                        <h4>Validador de Códigos</h4>
                        <div class="form-group">
                            <input type="text" id="codigo-validacao-admin" placeholder="Ex: RB-38472-X9F">
                        </div>
                        <button class="btn btn-secondary" onclick="validarCodigoAdmin()">
                            Validar Código
                        </button>
                        <div id="resultado-validacao-admin"></div>
                    </div>

                    <!-- Controles Admin -->
                    <div style="display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="carregarEstatisticas()">
                            Atualizar Stats
                        </button>
                        <button class="btn btn-secondary" onclick="toggleSistema()" id="btn-toggle-sistema">
                            Toggle Sistema
                        </button>
                    </div>
                </div>

                <!-- Configuração de Prêmios -->
                <div id="admin-controle-premios" class="admin-tab-content">
                    <div class="premio-config">
                        <h4>CONTROLE MANUAL DE PRÊMIOS</h4>
                        <p style="margin-bottom: 20px; color: #00b341; font-weight: 700;">Sistema configurado para liberação manual de prêmios. Apenas o administrador pode autorizar ganhadores.</p>
                    </div>

                    <!-- Liberar Prêmio Manual -->
                    <div class="premio-config">
                        <h4>Liberar Prêmio Manual</h4>
                        <p style="margin-bottom: 20px; color: #666;">Digite qualquer valor para liberar na próxima raspagem.</p>
                        
                        <div style="display: grid; gap: 20px;">
                            <!-- Valores Pré-definidos -->
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Valores Rápidos:</label>
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    <button class="btn btn-secondary" onclick="setPremioValue('R$ 10,00')" style="font-size: 14px; padding: 8px 15px;">R$ 10</button>
                                    <button class="btn btn-secondary" onclick="setPremioValue('R$ 20,00')" style="font-size: 14px; padding: 8px 15px;">R$ 20</button>
                                    <button class="btn btn-secondary" onclick="setPremioValue('R$ 50,00')" style="font-size: 14px; padding: 8px 15px;">R$ 50</button>
                                    <button class="btn btn-secondary" onclick="setPremioValue('R$ 100,00')" style="font-size: 14px; padding: 8px 15px;">R$ 100</button>
                                    <button class="btn btn-secondary" onclick="setPremioValue('R$ 500,00')" style="font-size: 14px; padding: 8px 15px;">R$ 500</button>
                                    <button class="btn btn-secondary" onclick="setPremioValue('R$ 1000,00')" style="font-size: 14px; padding: 8px 15px;">R$ 1000</button>
                                </div>
                            </div>
                            
                            <!-- Campo Personalizado -->
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Ou digite valor personalizado:</label>
                                <div style="display: flex; gap: 15px; align-items: center;">
                                    <input type="text" id="premio-manual-valor-custom" placeholder="Ex: R$ 250,00" style="flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; font-weight: 600;">
                                    <button class="btn btn-primary" onclick="liberarPremioManualCustom()">
                                        Liberar Prêmio
                                    </button>
                                </div>
                                <small style="color: #666; font-style: italic;">Formato: R$ 00,00 (qualquer valor acima de R$ 1,00)</small>
                            </div>
                        </div>
                        
                        <div id="status-premio-manual" style="margin-top: 15px;"></div>
                        
                        <!-- Status Atual -->
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-top: 25px; border: 2px solid #e9ecef;">
                            <h5 style="color: #495057; margin-bottom: 15px;">
                                Status Atual
                            </h5>
                            <div id="premio-status-atual">
                                <p style="color: #6c757d; font-style: italic;">Carregando status...</p>
                            </div>
                            <button class="btn btn-secondary" onclick="verificarStatusPremio()" style="margin-top: 10px;">
                                Atualizar Status
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Afiliados -->
                <div id="admin-controle-afiliados" class="admin-tab-content">
                    <h4>Gerenciar Afiliados</h4>
                    <div id="lista-afiliados">
                        <p>Carregando afiliados...</p>
                    </div>
                </div>

                <!-- Saques -->
                <div id="admin-controle-saques" class="admin-tab-content">
                    <h4>Solicitações de Saque</h4>
                    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="carregarSaquesGanhadores()">Saques Ganhadores</button>
                        <button class="btn btn-affiliate" onclick="carregarSaquesAfiliados()">Saques Afiliados</button>
                    </div>
                    <div id="lista-saques">
                        <p>Selecione um tipo de saque acima.</p>
                    </div>
                </div>

                <!-- Ganhadores -->
                <div id="admin-controle-ganhadores" class="admin-tab-content">
                    <h4>Lista de Ganhadores</h4>
                    <button class="btn btn-primary" onclick="listarPremiados()">
                        Carregar Ganhadores
                    </button>
                    <div id="lista-premiados"></div>
                </div>

                <!-- Vendas -->
                <div id="admin-controle-vendas" class="admin-tab-content">
                    <h4>Relatório de Vendas</h4>
                    <div id="vendas-stats">
                        <div class="status-bar">
                            <div class="status-item">
                                <span class="number" id="vendas-hoje">0</span>
                                <span class="label">Vendas Hoje</span>
                            </div>
                            <div class="status-item">
                                <span class="number" id="vendas-afiliados">0</span>
                                <span class="label">Via Afiliados</span>
                            </div>
                            <div class="status-item">
                                <span class="number" id="premios-restantes">0</span>
                                <span class="label">Prêmios Restantes</span>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="carregarRelatorioVendas()">
                        Atualizar Relatório
                    </button>
                    <div id="vendas-detalhes" style="margin-top: 25px;"></div>
                </div>

                <!-- Pagamentos Órfãos -->
                <div id="admin-controle-pagamentos" class="admin-tab-content">
                    <h4>Pagamentos Órfãos</h4>
                    <p style="margin-bottom: 20px; color: #666;">
                        Pagamentos aprovados onde o cliente não conseguiu raspar. 
                        <strong style="color: #dc2626;">Devem ser devolvidos!</strong>
                    </p>
                    <button class="btn btn-primary" onclick="carregarPagamentosOrfaos()">
                        Buscar Pagamentos Órfãos
                    </button>
                    <div id="lista-pagamentos-orfaos" style="margin-top: 25px;">
                        <p>Clique no botão acima para verificar.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal personalizado -->
    <div id="custom-modal" class="modal">
        <div class="modal-content">
            <div id="modal-message"></div>
            <div style="margin-top: 25px;">
                <button class="btn btn-secondary" onclick="fecharModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- Winner Alert Modal - COR VERDE -->
    <div id="winner-alert" class="winner-alert">
        <div class="winner-alert-content">
            <h2>ALGUÉM ACABOU DE GANHAR!</h2>
            <p><strong id="winner-name-alert">Maria Santos</strong></p>
            <p>acabou de ganhar <strong style="font-size: 1.5em;">R$ 1.000,00!</strong></p>
            <p>Seja o próximo ganhador!</p>
            <button class="close-btn" onclick="closeWinnerAlert()">QUERO JOGAR AGORA!</button>
        </div>
    </div>

    <script>
        // Variáveis globais
        let quantidade = 1;
        let paymentCheckInterval;
        let currentPaymentId = null;
        let vendidas = 0;
        let totalRaspadinhas = 10000;
        let currentSlide = 0;
        let currentAffiliate = null;
        let currentAdminTab = 'dashboard';
        const WHATSAPP_NUMERO = "5582996092684";

        // Sistema de nomes aleatórios para alertas de ganhadores
        const nomesAleatorios = [
            "Ana Beatriz Silva", "Carlos Eduardo Santos", "Maria Fernanda Costa", 
            "João Paulo Oliveira", "Juliana Rodrigues", "Pedro Henrique Lima",
            "Fernanda Almeida", "Roberto Carlos Pereira", "Mariana Souza",
            "André Luiz Ferreira", "Camila Martins", "Diego Nascimento",
            "Larissa Barbosa", "Rafael Moreira", "Tatiana Ribeiro",
            "Bruno Gonçalves", "Priscila Araújo", "Thiago Cardoso",
            "Vanessa Mendes", "Lucas Gabriel Torres", "Amanda Silva Santos",
            "Rodrigo Alves", "Bianca Fonseca", "Mateus Vieira",
            "Gabriela Rocha", "Felipe Machado", "Caroline Duarte",
            "Daniel Freitas", "Letícia Campos", "Gustavo Ramos",
            "Isabela Monteiro", "Henrique Batista", "Patrícia Lemos"
        ];

        const valoresAleatorios = [10, 20, 30, 40, 50, 100, 200, 500, 1000];

        function gerarGanhadorAleatorio() {
            const nome = nomesAleatorios[Math.floor(Math.random() * nomesAleatorios.length)];
            const valor = valoresAleatorios[Math.floor(Math.random() * valoresAleatorios.length)];
            return { nome, valor };
        }

        function gerarGanhadoresSlider() {
            const container = document.getElementById('winners-container');
            container.innerHTML = '';
            
            // Gerar 20 ganhadores aleatórios
            for (let i = 0; i < 20; i++) {
                const ganhador = gerarGanhadorAleatorio();
                const minutos = Math.floor(Math.random() * 120) + 5; // 5 a 125 minutos
                
                let tempoTexto;
                if (minutos < 60) {
                    tempoTexto = `Há ${minutos} minutos`;
                } else {
                    const horas = Math.floor(minutos / 60);
                    const minutosRestantes = minutos % 60;
                    if (minutosRestantes === 0) {
                        tempoTexto = `Há ${horas} hora${horas > 1 ? 's' : ''}`;
                    } else {
                        tempoTexto = `Há ${horas}h ${minutosRestantes}min`;
                    }
                }
                
                const item = document.createElement('div');
                item.className = 'winner-item';
                item.innerHTML = `
                    <div class="winner-name">${ganhador.nome}</div>
                    <div class="winner-prize">R$ ${ganhador.valor},00</div>
                    <div class="winner-time">${tempoTexto}</div>
                `;
                container.appendChild(item);
            }
            
            // Duplicar para loop contínuo
            const originalHTML = container.innerHTML;
            container.innerHTML = originalHTML + originalHTML;
        }

        // Função para mostrar alerta de ganhador SUPER CHAMATIVO
        function showWinnerAlert() {
            // Só mostrar na página inicial
            if (!document.getElementById('home-page').classList.contains('active')) {
                return;
            }

            const ganhador = gerarGanhadorAleatorio();
            document.getElementById('winner-name-alert').textContent = ganhador.nome;
            document.querySelector('#winner-alert .winner-alert-content p:nth-child(3)').innerHTML = 
                `acabou de ganhar <strong style="font-size: 1.5em;">R$ ${ganhador.valor},00!</strong>`;
            
            document.getElementById('winner-alert').style.display = 'flex';
            document.body.classList.add('shake-intense');
            
            // Vibração no celular se disponível
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
            
            setTimeout(() => {
                document.body.classList.remove('shake-intense');
            }, 600);
        }

        function closeWinnerAlert() {
            document.getElementById('winner-alert').style.display = 'none';
        }

        // Mostrar alerta para novos usuários (só na página inicial)
        function initWinnerAlerts() {
            // Mostrar primeiro alerta após 8 segundos
            setTimeout(() => {
                if (document.getElementById('home-page').classList.contains('active')) {
                    showWinnerAlert();
                }
            }, 8000);
            
            // Mostrar alertas a cada 45-90 segundos
            setInterval(() => {
                if (Math.random() < 0.25 && document.getElementById('home-page').classList.contains('active')) {
                    showWinnerAlert();
                }
            }, 60000);
        }

        // Função para formatar valores monetários com vírgula
        function formatarDinheiro(valor) {
            return valor.toFixed(2).replace('.', ',');
        }

        // Função para mostrar modal personalizado
        function mostrarModal(mensagem) {
            document.getElementById('modal-message').innerHTML = mensagem;
            document.getElementById('custom-modal').style.display = 'flex';
        }

        function fecharModal() {
            document.getElementById('custom-modal').style.display = 'none';
        }

        // Função para máscara de CPF
        function mascaraCPF(input) {
            let cpf = input.value.replace(/\D/g, '');
            cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2');
            cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2');
            cpf = cpf.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            input.value = cpf;
        }

        // Banner Slider
        function initBannerSlider() {
            const slides = document.querySelectorAll('.banner-slider .slide');
            
            setInterval(() => {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }, 5000);
        }

        // Função para alternar páginas
        function mostrarPagina(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        // Funções para quantidade com PROMOÇÃO 10+2
        function aumentarQuantidade() {
            if (quantidade < 10) {
                quantidade++;
                atualizarDisplay();
            }
        }

        function diminuirQuantidade() {
            if (quantidade > 1) {
                quantidade--;
                atualizarDisplay();
            }
        }

        function atualizarDisplay() {
            document.getElementById('quantidade-display').textContent = quantidade;
            
            // Aplicar promoção 10+2
            let quantidadeReal = quantidade;
            let valorTotal = quantidade * 1.00;
            
            const promocaoDiv = document.getElementById('promocao-bonus');
            
            if (quantidade === 10) {
                quantidadeReal = 12; // Ganha 2 grátis
                promocaoDiv.classList.add('ativa');
            } else {
                promocaoDiv.classList.remove('ativa');
            }
            
            document.getElementById('total-display').innerHTML = `
                Total: R$ ${formatarDinheiro(valorTotal)}${quantidade === 10 ? '<br><small style="color: #ff6b35;">+2 raspadinhas GRÁTIS!</small>' : ''}
            `;
        }

        // Funções de Afiliados
        function abrirAfiliados() {
            mostrarPagina('affiliate-page');
            // Verificar se já está logado como afiliado
            if (currentAffiliate) {
                exibirDashboardAfiliado();
            } else {
                document.getElementById('affiliate-signup').style.display = 'block';
                document.getElementById('affiliate-login').style.display = 'none';
                document.getElementById('affiliate-dashboard').style.display = 'none';
            }
        }

        function mostrarLoginAfiliado() {
            document.getElementById('affiliate-signup').style.display = 'none';
            document.getElementById('affiliate-login').style.display = 'block';
            document.getElementById('affiliate-dashboard').style.display = 'none';
        }

        function voltarCadastroAfiliado() {
            document.getElementById('affiliate-signup').style.display = 'block';
            document.getElementById('affiliate-login').style.display = 'none';
            document.getElementById('affiliate-dashboard').style.display = 'none';
        }

        async function cadastrarAfiliado() {
            const nome = document.getElementById('affiliate-nome').value.trim();
            const telefone = document.getElementById('affiliate-telefone').value.trim();
            const email = document.getElementById('affiliate-email').value.trim();
            const cpf = document.getElementById('affiliate-cpf').value.trim();

            if (!nome || !telefone || !email || !cpf) {
                mostrarModal('<h3>Atenção</h3><p>Por favor, preencha todos os campos!</p>');
                return;
            }

            if (nome.length < 3) {
                mostrarModal('<h3>Atenção</h3><p>Nome deve ter pelo menos 3 caracteres!</p>');
                return;
            }

            if (!email.includes('@')) {
                mostrarModal('<h3>Atenção</h3><p>Digite um e-mail válido!</p>');
                return;
            }

            if (cpf.replace(/\D/g, '').length !== 11) {
                mostrarModal('<h3>Atenção</h3><p>CPF deve ter 11 dígitos!</p>');
                return;
            }

            try {
                const response = await fetch('/cadastrar_afiliado', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        nome,
                        telefone,
                        email,
                        cpf: cpf.replace(/\D/g, '')
                    })
                });

                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    currentAffiliate = resultado.afiliado;
                    localStorage.setItem('affiliate_cpf', cpf.replace(/\D/g, ''));
                    
                    exibirDashboardAfiliado();
                    mostrarModal(`
                        <h3>Cadastro Realizado!</h3>
                        <p>Bem-vindo ao programa de afiliados!</p>
                        <p><strong>Seu código:</strong> ${resultado.afiliado.codigo}</p>
                        <p>Comece a compartilhar seu link e ganhar!</p>
                    `);
                } else {
                    mostrarModal(`<h3>Erro</h3><p>${resultado.erro}</p>`);
                }

            } catch (error) {
                console.error('Erro ao cadastrar afiliado:', error);
                mostrarModal('<h3>Erro</h3><p>Erro ao criar conta de afiliado. Tente novamente.</p>');
            }
        }

        async function loginAfiliado() {
            const cpf = document.getElementById('login-affiliate-cpf').value.replace(/\D/g, '');
            const messageDiv = document.getElementById('login-affiliate-message');
            
            if (!cpf || cpf.length !== 11) {
                messageDiv.innerHTML = '<div class="resultado-validacao invalido">Digite um CPF válido</div>';
                return;
            }
            
            try {
                const response = await fetch('/login_afiliado', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cpf })
                });

                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    currentAffiliate = resultado.afiliado;
                    localStorage.setItem('affiliate_cpf', cpf);
                    
                    exibirDashboardAfiliado();
                    messageDiv.innerHTML = '<div class="resultado-validacao valido">Login realizado com sucesso!</div>';
                } else {
                    messageDiv.innerHTML = `<div class="resultado-validacao invalido">${resultado.erro}</div>`;
                }
                
            } catch (error) {
                console.error('Erro no login afiliado:', error);
                messageDiv.innerHTML = '<div class="resultado-validacao invalido">Erro ao fazer login. Tente novamente.</div>';
            }
        }

        function exibirDashboardAfiliado() {
            document.getElementById('affiliate-signup').style.display = 'none';
            document.getElementById('affiliate-login').style.display = 'none';
            document.getElementById('affiliate-dashboard').style.display = 'block';
            
            document.getElementById('affiliate-name-display').textContent = currentAffiliate.nome;
            document.getElementById('affiliate-link-display').textContent = `${window.location.origin}/?ref=${currentAffiliate.codigo}`;
            document.getElementById('affiliate-clicks').textContent = currentAffiliate.total_clicks || 0;
            document.getElementById('affiliate-sales').textContent = currentAffiliate.total_vendas || 0;
            document.getElementById('affiliate-commission').textContent = `R$ ${formatarDinheiro(currentAffiliate.total_comissao || 0)}`;
            document.getElementById('affiliate-balance').textContent = `R$ ${formatarDinheiro(currentAffiliate.saldo_disponivel || 0)}`;
            
            if (currentAffiliate.chave_pix) {
                document.getElementById('affiliate-pix-type').value = currentAffiliate.tipo_chave_pix || 'cpf';
                document.getElementById('affiliate-pix-key').value = currentAffiliate.chave_pix;
            }
            
            atualizarBotaoSaque();
        }

        function logoutAfiliado() {
            currentAffiliate = null;
            localStorage.removeItem('affiliate_cpf');
            voltarCadastroAfiliado();
        }

        function copiarLinkAfiliado() {
            const link = document.getElementById('affiliate-link-display').textContent;
            navigator.clipboard.writeText(link).then(() => {
                mostrarModal(`
                    <h3>Link Copiado!</h3>
                    <p>Seu link de afiliado foi copiado para a área de transferência.</p>
                    <p>Compartilhe e comece a ganhar!</p>
                `);
            }).catch(() => {
                mostrarModal('<h3>Link copiado!</h3><p>Compartilhe e comece a ganhar!</p>');
            });
        }

        async function salvarChavePix() {
            const tipo = document.getElementById('affiliate-pix-type').value;
            const chave = document.getElementById('affiliate-pix-key').value.trim();
            
            if (!chave) {
                mostrarModal('<h3>Atenção</h3><p>Digite sua chave PIX!</p>');
                return;
            }
            
            if (chave.length < 5) {
                mostrarModal('<h3>Atenção</h3><p>Chave PIX inválida!</p>');
                return;
            }
            
            try {
                const response = await fetch('/atualizar_pix_afiliado', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        codigo: currentAffiliate.codigo,
                        chave_pix: chave,
                        tipo_chave: tipo
                    })
                });

                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    currentAffiliate.chave_pix = chave;
                    currentAffiliate.tipo_chave_pix = tipo;
                    atualizarBotaoSaque();
                    mostrarModal('<h3>Chave PIX Salva!</h3><p>Agora você pode solicitar saques.</p>');
                } else {
                    mostrarModal('<h3>Erro</h3><p>Erro ao salvar chave PIX</p>');
                }
            } catch (error) {
                console.error('Erro ao salvar PIX:', error);
                mostrarModal('<h3>Erro</h3><p>Erro ao salvar chave PIX</p>');
            }
        }

        function atualizarBotaoSaque() {
            const btnSaque = document.getElementById('btn-saque');
            if ((currentAffiliate.saldo_disponivel || 0) >= 10 && currentAffiliate.chave_pix) {
                btnSaque.disabled = false;
            } else {
                btnSaque.disabled = true;
            }
        }

        async function solicitarSaque() {
            if ((currentAffiliate.saldo_disponivel || 0) < 10) {
                mostrarModal('<h3>Saldo Insuficiente</h3><p>Saldo mínimo para saque: R$ 10,00</p>');
                return;
            }
            
            if (!currentAffiliate.chave_pix) {
                mostrarModal('<h3>Atenção</h3><p>Configure sua chave PIX primeiro!</p>');
                return;
            }
            
            try {
                const response = await fetch('/solicitar_saque_afiliado', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        codigo: currentAffiliate.codigo
                    })
                });

                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    currentAffiliate.saldo_disponivel = 0;
                    document.getElementById('affiliate-balance').textContent = 'R$ 0,00';
                    atualizarBotaoSaque();
                    
                    mostrarModal(`
                        <h3>Saque Solicitado!</h3>
                        <p>Valor: R$ ${formatarDinheiro(resultado.valor)}</p>
                        <p>PIX: ${currentAffiliate.chave_pix}</p>
                        <p>Processamento: até 24 horas</p>
                    `);
                } else {
                    mostrarModal(`<h3>Erro</h3><p>${resultado.erro}</p>`);
                }
            } catch (error) {
                console.error('Erro ao solicitar saque:', error);
                mostrarModal('<h3>Erro</h3><p>Erro ao solicitar saque</p>');
            }
        }

        // Admin functions
        function abrirAdmin() {
            document.getElementById('admin-modal').style.display = 'flex';
        }

        function fecharAdmin() {
            document.getElementById('admin-modal').style.display = 'none';
        }

        function trocarAbaAdmin(aba) {
            // Atualizar tabs
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.admin-tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`admin-${aba}`).classList.add('active');
            
            currentAdminTab = aba;
            
            // Carregar conteúdo específico da aba
            switch(aba) {
                case 'controle-afiliados':
                    carregarAfiliados();
                    break;
                case 'controle-vendas':
                    carregarRelatorioVendas();
                    break;
                case 'controle-premios':
                    verificarStatusPremio();
                    break;
                case 'controle-pagamentos':
                    // Não carrega automaticamente, só quando clicar no botão
                    break;
            }
        }

        async function loginAdmin() {
            const senha = document.getElementById('admin-senha').value;
            const messageDiv = document.getElementById('admin-message');
            
            if (!senha) {
                messageDiv.innerHTML = '<div class="resultado-validacao invalido">Digite a senha</div>';
                return;
            }
            
            try {
                const response = await fetch('/admin/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ senha })
                });
                
                const resultado = await response.json();
                
                if (resultado.success) {
                    document.getElementById('admin-login').style.display = 'none';
                    document.getElementById('admin-panel').style.display = 'block';
                    messageDiv.innerHTML = '<div class="resultado-validacao valido">Login realizado com sucesso!</div>';
                    await carregarEstatisticas();
                    verificarStatusPremio();
                } else {
                    messageDiv.innerHTML = '<div class="resultado-validacao invalido">Senha incorreta</div>';
                }
                
            } catch (error) {
                console.error('Erro no login admin:', error);
                messageDiv.innerHTML = '<div class="resultado-validacao invalido">Erro ao fazer login</div>';
            }
        }

        // Funções de Prêmio Manual - CORRIGIDAS
        function setPremioValue(valor) {
            document.getElementById('premio-manual-valor-custom').value = valor;
        }

        async function liberarPremioManualCustom() {
            const valor = document.getElementById('premio-manual-valor-custom').value.trim();
            const statusDiv = document.getElementById('status-premio-manual');
            
            if (!valor) {
                statusDiv.innerHTML = '<div class="resultado-validacao invalido">Digite um valor para o prêmio</div>';
                return;
            }
            
            // Validar formato básico
            if (!valor.startsWith('R$') && !valor.includes(',')) {
                statusDiv.innerHTML = '<div class="resultado-validacao invalido">Use o formato: R$ 00,00</div>';
                return;
            }
            
            try {
                const response = await fetch('/admin/liberar_premio_manual', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ valor })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    statusDiv.innerHTML = '<div class="resultado-validacao valido">Prêmio liberado! O próximo a raspar ganhará este valor.</div>';
                    document.getElementById('premio-manual-valor-custom').value = '';
                    verificarStatusPremio(); // Atualizar status
                } else {
                    statusDiv.innerHTML = `<div class="resultado-validacao invalido">${resultado.erro}</div>`;
                }
            } catch (error) {
                console.error('Erro ao liberar prêmio:', error);
                statusDiv.innerHTML = '<div class="resultado-validacao invalido">Erro ao liberar prêmio</div>';
            }
        }

        async function verificarStatusPremio() {
            const statusDiv = document.getElementById('premio-status-atual');
            
            try {
                const response = await fetch('/admin/verificar_status_premio');
                const resultado = await response.json();
                
                if (resultado.premio_liberado) {
                    statusDiv.innerHTML = `
                        <div style="color: #28a745; font-weight: bold;">
                            PRÊMIO LIBERADO: ${resultado.valor}
                        </div>
                        <p style="color: #666; font-size: 14px; margin-top: 5px;">O próximo jogador que raspar ganhará este valor!</p>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <div style="color: #6c757d;">
                            Nenhum prêmio liberado
                        </div>
                        <p style="color: #666; font-size: 14px; margin-top: 5px;">Sistema em modo manual. Libere um prêmio acima.</p>
                    `;
                }
            } catch (error) {
                console.error('Erro ao verificar status:', error);
                statusDiv.innerHTML = `
                    <div style="color: #dc2626;">
                        Erro ao verificar status
                    </div>
                `;
            }
        }

        async function carregarPagamentosOrfaos() {
            const container = document.getElementById('lista-pagamentos-orfaos');
            container.innerHTML = '<p>Carregando...</p>';
            
            try {
                const response = await fetch('/admin/pagamentos_orfaos');
                const resultado = await response.json();
                
                if (resultado.pagamentos && resultado.pagamentos.length > 0) {
                    let html = '<h5>Pagamentos Órfãos Encontrados:</h5>';
                    
                    resultado.pagamentos.forEach(pagamento => {
                        html += `
                            <div style="background: #ffe6e6; border: 2px solid #dc2626; padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                                <p><strong>Payment ID:</strong> ${pagamento.rb_payment_id}</p>
                                <p><strong>Valor:</strong> R$ ${parseFloat(pagamento.rb_valor_total).toFixed(2)}</p>
                                <p><strong>Quantidade:</strong> ${pagamento.rb_quantidade} raspadinha(s)</p>
                                <p><strong>Data:</strong> ${new Date(pagamento.rb_data_criacao).toLocaleString('pt-BR')}</p>
                                <p><strong>IP Cliente:</strong> ${pagamento.rb_ip_cliente}</p>
                                ${pagamento.rb_afiliado_id ? `<p><strong>Afiliado ID:</strong> ${pagamento.rb_afiliado_id}</p>` : ''}
                                
                                <div style="margin-top: 15px;">
                                    <button class="btn btn-primary" onclick="processarDevolucao('${pagamento.rb_payment_id}')" style="background: linear-gradient(135deg, #dc3545, #c82333); margin-right: 10px;">
                                        Devolver Dinheiro
                                    </button>
                                    <button class="btn btn-secondary" onclick="verificarPagamento('${pagamento.rb_payment_id}')">
                                        Verificar Status
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div class="resultado-validacao valido">Nenhum pagamento órfão encontrado!</div>';
                }
                
            } catch (error) {
                console.error('Erro ao carregar pagamentos órfãos:', error);
                container.innerHTML = '<div class="resultado-validacao invalido">Erro ao carregar pagamentos órfãos</div>';
            }
        }

        async function processarDevolucao(paymentId) {
            // Criar modal de confirmação personalizado
            const confirmarDevolucao = () => {
                return new Promise((resolve) => {
                    const modal = document.createElement('div');
                    modal.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                        background: rgba(0,0,0,0.8); display: flex; align-items: center;
                        justify-content: center; z-index: 10000;
                    `;
                    modal.innerHTML = `
                        <div style="background: white; padding: 30px; border-radius: 15px; max-width: 400px; text-align: center;">
                            <h3 style="color: #dc2626; margin-bottom: 20px;">Confirmar Devolução</h3>
                            <p style="margin-bottom: 25px;">Tem certeza que deseja devolver o dinheiro do pagamento ${paymentId}?</p>
                            <div style="display: flex; gap: 15px; justify-content: center;">
                                <button id="cancelar" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer;">Cancelar</button>
                                <button id="confirmar" style="padding: 12px 24px; background: #dc2626; color: white; border: none; border-radius: 8px; cursor: pointer;">Confirmar Devolução</button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    modal.querySelector('#cancelar').onclick = () => {
                        document.body.removeChild(modal);
                        resolve(false);
                    };
                    
                    modal.querySelector('#confirmar').onclick = () => {
                        document.body.removeChild(modal);
                        resolve(true);
                    };
                });
            };
            
            const confirmado = await confirmarDevolucao();
            if (!confirmado) return;
            
            try {
                const response = await fetch('/admin/processar_devolucao', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ payment_id: paymentId })
                });
                
                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarModal('<h3>Devolução Processada!</h3><p>O pagamento foi marcado como devolvido e removido das vendas.</p>');
                    carregarPagamentosOrfaos(); // Recarregar lista
                } else {
                    mostrarModal(`<h3>Erro</h3><p>${resultado.erro}</p>`);
                }
            } catch (error) {
                console.error('Erro ao processar devolução:', error);
                mostrarModal('<h3>Erro</h3><p>Erro ao processar devolução</p>');
            }
        }

        async function verificarPagamento(paymentId) {
            try {
                const response = await fetch(`/check_payment/${paymentId}`);
                const resultado = await response.json();
                
                mostrarModal(`
                    <h3>Status do Pagamento ${paymentId}</h3>
                    <p><strong>Status:</strong> ${resultado.status}</p>
                    <p><strong>Valor:</strong> R$ ${resultado.amount || 0}</p>
                    <p><strong>Data Criação:</strong> ${resultado.date_created || 'N/A'}</p>
                    <p><strong>Data Aprovação:</strong> ${resultado.date_approved || 'N/A'}</p>
                `);
            } catch (error) {
                console.error('Erro ao verificar pagamento:', error);
                mostrarModal('<h3>Erro</h3><p>Erro ao verificar pagamento</p>');
            }
        }

        async function carregarEstatisticas() {
            try {
                const response = await fetch('/admin/stats');
                const stats = await response.json();
                
                document.getElementById('admin-vendidas').textContent = stats.vendidas || 0;
                document.getElementById('admin-restantes').textContent = (stats.total_raspadinhas || totalRaspadinhas) - (stats.vendidas || 0);
                document.getElementById('admin-porcentagem').textContent = `${Math.round(((stats.vendidas || 0) / (stats.total_raspadinhas || totalRaspadinhas)) * 100)}%`;
                document.getElementById('admin-ganhadores').textContent = stats.ganhadores || 0;
                document.getElementById('admin-afiliados').textContent = stats.afiliados || 0;
                document.getElementById('admin-premios-restantes').textContent = stats.premios_restantes || 0;
                
                vendidas = stats.vendidas || 0;
                
                // Atualizar botão do sistema
                const btnToggle = document.getElementById('btn-toggle-sistema');
                if (btnToggle) {
                    btnToggle.innerHTML = `
                        ${stats.sistema_ativo ? 'Desativar' : 'Ativar'} Sistema
                    `;
                    btnToggle.style.background = stats.sistema_ativo ? 
                        'linear-gradient(135deg, #dc3545, #c82333)' : 
                        'linear-gradient(135deg, #28a745, #20c997)';
                }
                
            } catch (error) {
                console.error('Erro ao carregar estatísticas:', error);
            }
        }

        async function carregarAfiliados() {
            try {
                const response = await fetch('/admin/afiliados');
                const resultado = await response.json();
                
                if (resultado.afiliados && resultado.afiliados.length > 0) {
                    let html = '';
                    resultado.afiliados.forEach(afiliado => {
                        html += `
                            <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                                <h5>${afiliado.nome} (${afiliado.codigo})</h5>
                                <p><strong>E-mail:</strong> ${afiliado.email}</p>
                                <p><strong>Telefone:</strong> ${afiliado.telefone}</p>
                                <p><strong>Clicks:</strong> ${afiliado.total_clicks} | <strong>Vendas:</strong> ${afiliado.total_vendas}</p>
                                <p><strong>Comissão Total:</strong> R$ ${afiliado.total_comissao.toFixed(2)} | <strong>Saldo:</strong> R$ ${afiliado.saldo_disponivel.toFixed(2)}</p>
                                <p><strong>Status:</strong> ${afiliado.status}</p>
                                <p><strong>Cadastrado em:</strong> ${new Date(afiliado.data_criacao).toLocaleString('pt-BR')}</p>
                            </div>
                        `;
                    });
                    document.getElementById('lista-afiliados').innerHTML = html;
                } else {
                    document.getElementById('lista-afiliados').innerHTML = '<p>Nenhum afiliado cadastrado ainda.</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar afiliados:', error);
                document.getElementById('lista-afiliados').innerHTML = '<p>Erro ao carregar afiliados.</p>';
            }
        }

        async function carregarSaquesGanhadores() {
            try {
                const response = await fetch('/admin/saques_ganhadores');
                const resultado = await response.json();
                
                let html = '<h5>Solicitações de Saque - Ganhadores</h5>';
                
                if (resultado.saques && resultado.saques.length > 0) {
                    resultado.saques.forEach(saque => {
                        const statusClass = saque.rb_status === 'pago' ? 'success' : 'warning';
                        const statusText = saque.rb_status === 'pago' ? 'Pago' : 'Pendente';
                        
                        html += `
                            <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                                <p><strong>${saque.rb_ganhadores?.rb_nome || 'Nome não encontrado'}</strong> - R$ ${parseFloat(saque.rb_valor).toFixed(2)}</p>
                                <p><strong>PIX:</strong> ${saque.rb_chave_pix}</p>
                                <p><strong>Código:</strong> ${saque.rb_ganhadores?.rb_codigo || 'N/A'}</p>
                                <p><strong>Status:</strong> <span class="cta-message ${statusClass}" style="padding: 5px 10px; border-radius: 5px; font-size: 0.9em; margin: 0;">${statusText}</span></p>
                                <p><strong>Data:</strong> ${new Date(saque.rb_data_solicitacao).toLocaleString('pt-BR')}</p>
                                <div style="margin-top: 15px;">
                                    ${saque.rb_status === 'pago' ? 
                                        `<button class="btn btn-primary" onclick="excluirSaqueGanhador(${saque.rb_id})" style="background: linear-gradient(135deg, #dc3545, #c82333);">
                                            Excluir
                                        </button>` :
                                        `<button class="btn btn-primary" onclick="pagarSaqueGanhador(${saque.rb_id})">
                                            Pagar
                                        </button>`
                                    }
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += '<p>Nenhuma solicitação de saque encontrada.</p>';
                }
                
                document.getElementById('lista-saques').innerHTML = html;
            } catch (error) {
                console.error('Erro ao carregar saques de ganhadores:', error);
                document.getElementById('lista-saques').innerHTML = '<p>Erro ao carregar saques.</p>';
            }
        }

        async function carregarSaquesAfiliados() {
            try {
                const response = await fetch('/admin/saques_afiliados');
                const resultado = await response.json();
                
                let html = '<h5>Solicitações de Saque - Afiliados</h5>';
                
                if (resultado.saques && resultado.saques.length > 0) {
                    resultado.saques.forEach(saque => {
                        const statusClass = saque.rb_status === 'pago' ? 'success' : 'warning';
                        const statusText = saque.rb_status === 'pago' ? 'Pago' : 'Pendente';
                        
                        html += `
                            <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                                <p><strong>${saque.rb_afiliados?.rb_nome || 'Nome não encontrado'} (${saque.rb_afiliados?.rb_codigo || 'N/A'})</strong> - R$ ${parseFloat(saque.rb_valor).toFixed(2)}</p>
                                <p><strong>PIX:</strong> ${saque.rb_chave_pix}</p>
                                <p><strong>Comissão de:</strong> ${saque.rb_afiliados?.rb_total_vendas || 0} vendas</p>
                                <p><strong>Status:</strong> <span class="cta-message ${statusClass}" style="padding: 5px 10px; border-radius: 5px; font-size: 0.9em; margin: 0;">${statusText}</span></p>
                                <p><strong>Data:</strong> ${new Date(saque.rb_data_solicitacao).toLocaleString('pt-BR')}</p>
                                <div style="margin-top: 15px;">
                                    ${saque.rb_status === 'pago' ? 
                                        `<button class="btn btn-affiliate" onclick="excluirSaqueAfiliado(${saque.rb_id})" style="background: linear-gradient(135deg, #dc3545, #c82333);">
                                            Excluir
                                        </button>` :
                                        `<button class="btn btn-affiliate" onclick="pagarSaqueAfiliado(${saque.rb_id})">
                                            Pagar
                                        </button>`
                                    }
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += '<p>Nenhuma solicitação de saque encontrada.</p>';
                }
                
                document.getElementById('lista-saques').innerHTML = html;
            } catch (error) {
                console.error('Erro ao carregar saques de afiliados:', error);
                document.getElementById('lista-saques').innerHTML = '<p>Erro ao carregar saques.</p>';
            }
        }

        async function carregarRelatorioVendas() {
            try {
                const response = await fetch('/admin/stats');
                const stats = await response.json();
                
                document.getElementById('vendas-hoje').textContent = stats.vendas_hoje || 0;
                document.getElementById('vendas-afiliados').textContent = stats.vendas_afiliados_hoje || 0;
                document.getElementById('premios-restantes').textContent = stats.premios_restantes || 0;
                
                const vendasDiretas = (stats.vendas_hoje || 0) - (stats.vendas_afiliados_hoje || 0);
                const totalArrecadado = stats.vendas_hoje || 0;
                const comissoesPagas = (stats.vendas_afiliados_hoje || 0) * 0.5;
                const lucroLiquido = totalArrecadado - comissoesPagas;
                
                document.getElementById('vendas-detalhes').innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 15px;">
                        <h5>Detalhes das Vendas de Hoje</h5>
                        <p><strong>Vendas Diretas:</strong> ${vendasDiretas} raspadinhas (R$ ${vendasDiretas.toFixed(2)})</p>
                        <p><strong>Vendas via Afiliados:</strong> ${stats.vendas_afiliados_hoje || 0} raspadinhas (R$ ${(stats.vendas_afiliados_hoje || 0).toFixed(2)})</p>
                        <p><strong>Total Arrecadado:</strong> R$ ${totalArrecadado.toFixed(2)}</p>
                        <p><strong>Comissões Pagas:</strong> R$ ${comissoesPagas.toFixed(2)}</p>
                        <p><strong>Lucro Líquido:</strong> R$ ${lucroLiquido.toFixed(2)}</p>
                    </div>
                `;
            } catch (error) {
                console.error('Erro ao carregar relatório de vendas:', error);
                document.getElementById('vendas-detalhes').innerHTML = '<p>Erro ao carregar relatório.</p>';
            }
        }

        async function toggleSistema() {
            try {
                const response = await fetch('/admin/toggle_sistema', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const resultado = await response.json();
                
                if (resultado.success) {
                    mostrarModal(`<h3>${resultado.mensagem}</h3>`);
                    await carregarEstatisticas();
                } else {
                    mostrarModal(`<h3>${resultado.mensagem}</h3>`);
                }
                
            } catch (error) {
                console.error('Erro ao alternar sistema:', error);
                mostrarModal('<h3>Erro ao alternar sistema</h3>');
            }
        }

        async function validarCodigoAdmin() {
            const codigo = document.getElementById('codigo-validacao-admin').value.trim();
            const resultadoDiv = document.getElementById('resultado-validacao-admin');
            
            if (!codigo) {
                resultadoDiv.innerHTML = '<div class="resultado-validacao invalido">Por favor, insira um código</div>';
                return;
            }
            
            try {
                const response = await fetch('/validar_codigo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ codigo })
                });
                
                const resultado = await response.json();
                
                if (resultado.valido) {
                    resultadoDiv.innerHTML = `<div class="resultado-validacao valido">${resultado.mensagem}</div>`;
                } else {
                    resultadoDiv.innerHTML = `<div class="resultado-validacao invalido">${resultado.mensagem}</div>`;
                }
                
            } catch (error) {
                console.error('Erro ao validar código:', error);
                resultadoDiv.innerHTML = '<div class="resultado-validacao invalido">Erro ao validar código</div>';
            }
        }

        async function listarPremiados() {
            const listDiv = document.getElementById('lista-premiados');
            
            try {
                const response = await fetch('/admin/premiados');
                const resultado = await response.json();
                
                if (resultado.premiados && resultado.premiados.length > 0) {
                    let html = '<h4>Lista de Ganhadores:</h4><div class="premiados-table">';
                    resultado.premiados.forEach(premiado => {
                        html += `
                            <div class="premiado-item">
                                <strong>Código:</strong> ${premiado.rb_codigo}<br>
                                <strong>Nome:</strong> ${premiado.rb_nome}<br>
                                <strong>Valor:</strong> ${premiado.rb_valor}<br>
                                <strong>PIX:</strong> ${premiado.rb_chave_pix}<br>
                                <strong>Status:</strong> ${premiado.rb_status_pagamento || 'pendente'}<br>
                                <strong>Data:</strong> ${new Date(premiado.rb_data_criacao).toLocaleString('pt-BR')}<br>
                            </div>
                        `;
                    });
                    html += '</div>';
                    listDiv.innerHTML = html;
                } else {
                    listDiv.innerHTML = '<p>Nenhum ganhador encontrado.</p>';
                }
                
            } catch (error) {
                console.error('Erro ao listar premiados:', error);
                listDiv.innerHTML = '<p>Erro ao carregar ganhadores.</p>';
            }
        }

        // Navegação
        function irParaPagamento() {
            // Verificar se há código de afiliado armazenado
            const refCode = localStorage.getItem('raspa_ref');
            
            // Aplicar promoção 10+2 no pagamento
            let quantidadeReal = quantidade;
            if (quantidade === 10) {
                quantidadeReal = 12; // 10 + 2 grátis
            }
            
            document.getElementById('quantidade-pagamento').textContent = `${quantidade}${quantidade === 10 ? ' (+2 grátis)' : ''}`;
            document.getElementById('total-pagamento').textContent = formatarDinheiro(quantidade * 1.00);
            document.getElementById('total-pagamento-info').textContent = formatarDinheiro(quantidade * 1.00);
            mostrarPagina('payment-page');
            setTimeout(() => criarPagamentoReal(refCode), 1500);
        }

        function voltarInicio() {
            mostrarPagina('home-page');
            // Limpar intervalo de verificação de pagamento se existir
            if (paymentCheckInterval) {
                clearInterval(paymentCheckInterval);
                paymentCheckInterval = null;
            }
        }

        function irParaRaspadinhas() {
            // Aplicar promoção 10+2
            let quantidadeReal = quantidade;
            if (quantidade === 10) {
                quantidadeReal = 12; // 10 + 2 grátis
            }
            
            document.getElementById('quantidade-raspadinhas').textContent = quantidadeReal;
            quantidade = quantidadeReal; // Atualizar quantidade para gerar as raspadinhas corretas
            gerarRaspadinhas();
            mostrarPagina('raspadinha-page');
        }

        // Função para verificar se tem raspadinhas disponíveis para este pagamento
        async function verificarRaspadinhasDisponiveis() {
            try {
                const response = await fetch('/verificar_raspadinhas_disponiveis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const resultado = await response.json();
                return resultado.disponivel || false;
            } catch (error) {
                console.error('Erro ao verificar raspadinhas:', error);
                return false;
            }
        }

        // Função para criar pagamento real no Mercado Pago
        async function criarPagamentoReal(refCode) {
            const btn = document.getElementById('btn-real-payment');
            if (btn) {
                const originalText = btn.innerHTML;
                btn.innerHTML = 'Criando pagamento...';
                btn.disabled = true;
            }

            // Esconder ações de pagamento
            const paymentActions = document.getElementById('payment-actions');
            if (paymentActions) {
                paymentActions.style.display = 'none';
            }

            try {
                const paymentData = { quantidade: quantidade };
                if (refCode) {
                    paymentData.ref_code = refCode;
                }

                const response = await fetch('/create_payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(paymentData)
                });

                const data = await response.json();

                if (response.ok && data.id) {
                    currentPaymentId = data.id;
                    
                    // Atualizar QR Code com dados reais
                    if (data.qr_code_base64) {
                        document.getElementById('qr-code').innerHTML = `<img src="data:image/png;base64,${data.qr_code_base64}" alt="QR Code PIX Real">`;
                    }
                    if (data.qr_code) {
                        document.getElementById('pix-code').textContent = data.qr_code;
                    }

                    document.getElementById('qr-section').style.display = 'block';
                    document.getElementById('payment-status').innerHTML = `
                        <div class="cta-message payment-status-waiting">
                            <h3>Aguardando Pagamento</h3>
                            <p style="margin: 15px 0; font-size: clamp(1em, 3.5vw, 1.2em); color: #1a1a1a; font-weight: 700;">ID: ${data.id}</p>
                            <p style="font-size: clamp(0.85em, 3vw, 1em); opacity: 0.8; color: #1a1a1a; font-weight: 600;"><em>Escaneie o QR Code ou cole o código PIX no seu banco</em></p>
                        </div>
                    `;

                    // Iniciar verificação automática do pagamento
                    iniciarVerificacaoPagamento(data.id);

                } else {
                    throw new Error(data.error || 'Erro ao criar pagamento');
                }

            } catch (error) {
                console.error('Erro ao criar pagamento real:', error);
                document.getElementById('payment-status').innerHTML = `
                    <div class="cta-message payment-status-error">
                        <h3>Erro ao Criar Pagamento</h3>
                        <p style="margin: 15px 0; font-size: clamp(1em, 3.5vw, 1.2em);">${error.message}</p>
                        <p style="font-size: clamp(0.85em, 3vw, 1em); opacity: 0.8;"><em>Tente novamente ou entre em contato</em></p>
                    </div>
                `;
                
                // Mostrar ações novamente em caso de erro
                if (paymentActions) {
                    paymentActions.style.display = 'block';
                }
                if (btn) {
                    btn.innerHTML = 'Tentar Novamente';
                    btn.disabled = false;
                }
            }
        }

        // Função para verificar pagamento automaticamente
        function iniciarVerificacaoPagamento(paymentId) {
            if (paymentCheckInterval) {
                clearInterval(paymentCheckInterval);
            }

            let tentativas = 0;
            const maxTentativas = 120; // 10 minutos (120 * 5 segundos)

            paymentCheckInterval = setInterval(async () => {
                tentativas++;
                
                try {
                    const response = await fetch(`/check_payment/${paymentId}`);
                    const data = await response.json();

                    console.log(`Verificação ${tentativas}/${maxTentativas} - Status: ${data.status}`);

                    if (data.status === 'approved') {
                        clearInterval(paymentCheckInterval);
                        paymentCheckInterval = null;

                        document.getElementById('payment-status').innerHTML = `
                            <div class="cta-message payment-status-approved">
                                <h3>Pagamento Aprovado!</h3>
                                <p style="margin: 15px 0; font-size: clamp(1em, 3.5vw, 1.2em);">Redirecionando para suas raspadinhas...</p>
                                <div style="margin-top: 20px;">
                                    <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid white; border-top: 4px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                </div>
                            </div>
                        `;

                        setTimeout(() => {
                            irParaRaspadinhas();
                        }, 3000);

                    } else if (data.status === 'rejected' || data.status === 'cancelled') {
                        clearInterval(paymentCheckInterval);
                        paymentCheckInterval = null;

                        document.getElementById('payment-status').innerHTML = `
                            <div class="cta-message payment-status-error">
                                <h3>Pagamento ${data.status === 'rejected' ? 'Rejeitado' : 'Cancelado'}</h3>
                                <p style="margin: 15px 0; font-size: clamp(1em, 3.5vw, 1.2em);">Tente novamente com outro método</p>
                            </div>
                        `;

                        // Reativar botão para tentar novamente
                        const paymentActions = document.getElementById('payment-actions');
                        if (paymentActions) {
                            paymentActions.style.display = 'block';
                        }
                        const btn = document.getElementById('btn-real-payment');
                        if (btn) {
                            btn.innerHTML = 'Tentar Novamente';
                            btn.disabled = false;
                        }

                    } else if (tentativas >= maxTentativas) {
                        // Timeout após 10 minutos
                        clearInterval(paymentCheckInterval);
                        paymentCheckInterval = null;

                        document.getElementById('payment-status').innerHTML = `
                            <div class="cta-message payment-status-error">
                                <h3>Tempo Esgotado</h3>
                                <p style="margin: 15px 0; font-size: clamp(1em, 3.5vw, 1.2em);">O pagamento demorou muito para ser confirmado</p>
                                <p style="font-size: clamp(0.85em, 3vw, 1em); opacity: 0.8;"><em>Se você já pagou, aguarde alguns minutos e recarregue a página</em></p>
                            </div>
                        `;
                    }

                } catch (error) {
                    console.error('Erro ao verificar pagamento:', error);
                    
                    if (tentativas >= maxTentativas) {
                        clearInterval(paymentCheckInterval);
                        paymentCheckInterval = null;
                    }
                }
            }, 5000); // Verificar a cada 5 segundos
        }

        // Função para copiar código PIX
        function copiarCodigoPix() {
            const codigo = document.getElementById('pix-code').textContent;
            navigator.clipboard.writeText(codigo).then(() => {
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = 'Copiado!';
                btn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                }, 3000);
            }).catch(() => {
                mostrarModal('Código PIX copiado para a área de transferência!');
            });
        }

        // Função para gerar raspadinhas com NOVO MODELO
        function gerarRaspadinhas() {
            const grid = document.getElementById('raspadinha-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < quantidade; i++) {
                const raspadinhaContainer = document.createElement('div');
                raspadinhaContainer.className = 'raspadinha-container';
                raspadinhaContainer.innerHTML = `
                    <div class="raspadinha-content">
                        <h2 class="raspadinha-titulo">Raspe a bandeira do Brasil</h2>
                        <div class="raspadinha" id="raspadinha-${i}">
                            <div class="premio" id="premio-${i}"></div>
                            <canvas id="scratch-${i}" width="300" height="180"></canvas>
                        </div>
                    </div>
                `;
                
                grid.appendChild(raspadinhaContainer);
                
                // Inicializar raspadinha
                setTimeout(() => inicializarRaspadinha(i), 100);
            }
        }

        // Função para inicializar cada raspadinha individual
        function inicializarRaspadinha(index) {
            const canvas = document.getElementById(`scratch-${index}`);
            const ctx = canvas.getContext("2d");
            const premioDiv = document.getElementById(`premio-${index}`);

            let raspando = false;
            let premioDefinido = false;

            function desenharCapa() {
                const bandeira = new Image();
                bandeira.src = "https://upload.wikimedia.org/wikipedia/commons/0/05/Flag_of_Brazil.svg";
                bandeira.onload = () => {
                    ctx.drawImage(bandeira, 0, 0, canvas.width, canvas.height);
                };
                bandeira.onerror = () => {
                    // Fallback caso não carregue a bandeira
                    ctx.fillStyle = "#00b341";
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = "#ffd700";
                    ctx.font = "20px Arial";
                    ctx.textAlign = "center";
                    ctx.fillText("BRASIL", canvas.width/2, canvas.height/2);
                };
            }

            function raspar(e) {
                if (!raspando) return;
                
                // Se ainda não definiu o prêmio, define agora
                if (!premioDefinido) {
                    definirPremio();
                    premioDefinido = true;
                }
                
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                
                ctx.globalCompositeOperation = "destination-out";
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
            }

            async function definirPremio() {
                try {
                    const response = await fetch('/raspar', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.erro || 'Erro ao processar raspagem');
                    }
                    
                    const resultado = await response.json();
                    
                    if (resultado.ganhou) {
                        premioDiv.innerHTML = `GANHOU<br>${resultado.valor}`;
                        premioDiv.style.background = "#4CAF50";
                        
                        // Mostrar formulário de prêmio
                        setTimeout(() => {
                            mostrarFormularioPremio(resultado.valor, resultado.codigo);
                        }, 2000);
                    } else {
                        premioDiv.innerHTML = "Tente<br>NOVAMENTE";
                        premioDiv.style.background = "#f44336";
                    }
                } catch (error) {
                    console.error('Erro ao processar prêmio:', error);
                    premioDiv.innerHTML = "Erro<br>" + error.message;
                    premioDiv.style.background = "#f44336";
                }
            }

            // Event listeners para mouse
            canvas.addEventListener("mousedown", () => raspando = true);
            canvas.addEventListener("mouseup", () => raspando = false);
            canvas.addEventListener("mousemove", raspar);

            // Event listeners para touch
            canvas.addEventListener("touchstart", (e) => {
                e.preventDefault();
                raspando = true;
            });
            canvas.addEventListener("touchend", (e) => {
                e.preventDefault();
                raspando = false;
            });
            canvas.addEventListener("touchmove", (e) => {
                e.preventDefault();
                raspar(e);
            });

            // Inicializar
            desenharCapa();
        }

        // Função para mostrar formulário de prêmio
        function mostrarFormularioPremio(valor, codigo) {
            const container = document.getElementById('premio-container');
            container.innerHTML = `
                <div class="premio-form">
                    <h3>PARABÉNS! VOCÊ GANHOU ${valor}!</h3>
                    <p style="text-align: center; font-size: clamp(1em, 4vw, 1.2em); margin-bottom: 30px; font-weight: 600;">
                        Preencha seus dados para receber o prêmio em até 24 horas:
                    </p>
                    
                    <div class="form-group">
                        <label>Nome Completo:</label>
                        <input type="text" id="nome-ganhador" placeholder="Digite seu nome completo" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Tipo de Chave PIX:</label>
                        <select id="tipo-chave">
                            <option value="cpf">CPF</option>
                            <option value="email">E-mail</option>
                            <option value="telefone">Telefone</option>
                            <option value="aleatoria">Chave Aleatória</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Chave PIX:</label>
                        <input type="text" id="chave-pix" placeholder="Digite sua chave PIX" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Código de Validação:</label>
                        <input type="text" id="codigo-antifraude" value="${codigo}" readonly style="background: #f8f9fa; font-weight: 700; color: #00b341;">
                    </div>
                    
                    <button class="whatsapp-btn" onclick="enviarWhatsApp('${valor}', '${codigo}')">
                        Enviar dados via WhatsApp
                    </button>

                    <div style="background: linear-gradient(135deg, #e8f4f8, #d1ecf1); padding: 20px; border-radius: 12px; margin-top: 25px; font-size: clamp(0.85em, 3vw, 1em); text-align: center; border: 2px solid #17a2b8;">
                        <p><strong>Seus dados estão seguros!</strong></p>
                        <p>Use o código de validação <strong>${codigo}</strong> para comprovar seu prêmio a qualquer momento.</p>
                        <p><strong>WhatsApp:</strong> ${WHATSAPP_NUMERO.replace('55', '+55 ')}</p>
                    </div>
                </div>
            `;
            container.style.display = 'block';
            
            // Scroll para o formulário
            container.scrollIntoView({ behavior: 'smooth' });
        }

        // Função para enviar via WhatsApp (conectada ao backend)
        async function enviarWhatsApp(valor, codigo) {
            const nome = document.getElementById('nome-ganhador').value.trim();
            const tipoChave = document.getElementById('tipo-chave').value;
            const chavePix = document.getElementById('chave-pix').value.trim();
            
            if (!nome || !chavePix) {
                mostrarModal('<h3>Atenção</h3><p>Por favor, preencha todos os campos antes de continuar!</p>');
                return;
            }

            if (nome.length < 3) {
                mostrarModal('<h3>Atenção</h3><p>Nome deve ter pelo menos 3 caracteres!</p>');
                return;
            }

            if (chavePix.length < 5) {
                mostrarModal('<h3>Atenção</h3><p>Chave PIX inválida!</p>');
                return;
            }
            
            try {
                // Salvar no backend
                const response = await fetch('/salvar_ganhador', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nome,
                        valor,
                        chave_pix: chavePix,
                        tipo_chave: tipoChave,
                        codigo
                    })
                });

                const resultado = await response.json();
                
                if (!resultado.sucesso) {
                    throw new Error(resultado.erro || 'Erro ao salvar dados');
                }
                
                const mensagem = `GANHEI NA RASPA BRASIL!

DADOS DO GANHADOR:
• Nome: ${nome}
• Prêmio: ${valor}
• Tipo de chave: ${tipoChave}
• Chave PIX: ${chavePix}
• Código de validação: ${codigo}

Solicito o pagamento do meu prêmio!

Dados salvos no sistema com sucesso!`;
                
                const whatsappUrl = `https://wa.me/${WHATSAPP_NUMERO}?text=${encodeURIComponent(mensagem)}`;
                window.open(whatsappUrl, '_blank');
                
                mostrarModal(`
                    <h3>Dados Enviados com Sucesso!</h3>
                    <p>Seu WhatsApp foi aberto com a mensagem pronta.</p>
                    <p><strong>Seu código de validação:</strong></p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 1.2em; color: #00b341; font-weight: bold; margin: 10px 0;">${codigo}</div>
                    <p><strong>IMPORTANTE:</strong> Guarde este código para validação!</p>
                    <p>Prazo para pagamento: <strong>até 24 horas</strong></p>
                `);
                
            } catch (error) {
                console.error('Erro ao salvar ganhador:', error);
                mostrarModal(`<h3>Erro</h3><p>${error.message}</p><p>Tente novamente ou entre em contato pelo WhatsApp</p>`);
            }
        }

        // Funções para gerenciar saques
        async function pagarSaqueGanhador(saqueId) {
            try {
                const response = await fetch(`/admin/pagar_saque_ganhador/${saqueId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarModal('<h3>Saque Pago!</h3><p>O saque foi marcado como pago com sucesso.</p>');
                    carregarSaquesGanhadores(); // Recarregar lista
                } else {
                    mostrarModal(`<h3>Erro</h3><p>${resultado.erro}</p>`);
                }
            } catch (error) {
                console.error('Erro ao pagar saque:', error);
                mostrarModal('<h3>Erro</h3><p>Erro ao processar pagamento do saque.</p>');
            }
        }

        async function excluirSaqueGanhador(saqueId) {
            try {
                const response = await fetch(`/admin/excluir_saque_ganhador/${saqueId}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' }
                });

                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarModal('<h3>Saque Excluído!</h3><p>O saque foi removido do sistema.</p>');
                    carregarSaquesGanhadores(); // Recarregar lista
                } else {
                    mostrarModal(`<h3>Erro</h3><p>${resultado.erro}</p>`);
                }
            } catch (error) {
                console.error('Erro ao excluir saque:', error);
                mostrarModal('<h3>Erro</h3><p>Erro ao excluir saque.</p>');
            }
        }

        async function pagarSaqueAfiliado(saqueId) {
            try {
                const response = await fetch(`/admin/pagar_saque_afiliado/${saqueId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarModal('<h3>Saque Pago!</h3><p>O saque foi marcado como pago com sucesso.</p>');
                    carregarSaquesAfiliados(); // Recarregar lista
                } else {
                    mostrarModal(`<h3>Erro</h3><p>${resultado.erro}</p>`);
                }
            } catch (error) {
                console.error('Erro ao pagar saque:', error);
                mostrarModal('<h3>Erro</h3><p>Erro ao processar pagamento do saque.</p>');
            }
        }

        async function excluirSaqueAfiliado(saqueId) {
            try {
                const response = await fetch(`/admin/excluir_saque_afiliado/${saqueId}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' }
                });

                const resultado = await response.json();
                
                if (resultado.sucesso) {
                    mostrarModal('<h3>Saque Excluído!</h3><p>O saque foi removido do sistema.</p>');
                    carregarSaquesAfiliados(); // Recarregar lista
                } else {
                    mostrarModal(`<h3>Erro</h3><p>${resultado.erro}</p>`);
                }
            } catch (error) {
                console.error('Erro ao excluir saque:', error);
                mostrarModal('<h3>Erro</h3><p>Erro ao excluir saque.</p>');
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            atualizarDisplay();
            initBannerSlider();
            initWinnerAlerts();
            gerarGanhadoresSlider();
            
            // Verificar se há código de afiliado na URL
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            if (refCode) {
                localStorage.setItem('raspa_ref', refCode);
                console.log('Código de afiliado detectado:', refCode);
            }
            
            // Verificar login automático do afiliado
            const savedCpf = localStorage.getItem('affiliate_cpf');
            if (savedCpf) {
                // Auto-login do afiliado (implementar se necessário)
            }
            
            // Carregar estatísticas periodicamente
            setInterval(carregarEstatisticas, 30000);
        });

        // Detectar modo escuro
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
</body>
</html>
